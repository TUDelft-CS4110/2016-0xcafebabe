#Pham
data = open("ZeusBinary.bin","rb").read()
key = "2A83FADF8B5852AA3F7D46D5728738ABA4D1685698A3AAA5E723381148405384AEC5ADF372F5EDE2CBD43A186457C35B1D3B303B54322FF145DF6BE0D7FB4634F2FAC2F13EAA4A117D6D3EA3DCDA67A6ED13FDCC51CC6ED64CD9C2E43A45A51A39EABD31663D7D7C545E794932BFD3CC158A96D966F01093F5C18D5C562139A1432BCE8CA2AAB0E4483955DF368689C3345268F24BCD7554C848B406E313B855BA5997489550914FD24C74137E483B5F7D5E4F124F525A5B555A6A5F2553544FE1D821EDF79A52C961A8C32CF2BAFEC587C1C3139FFAA07F5738A360596F0B26ED00FBA4D8C429ED7568FE1FDAD3E60E1C9C53C8DD776D2CA59EED5E7EB84AF39555D354963BD681877AD95F50B78FF9902DCD678C87A5F46CE1FB968E9D360F5069B157980ACB578572BCC514FEB95D540AA1416BBE302EA4953463012EA7D0DED625816D3F483F726BD62C8C3FFB9326CEB7B142374EAF46D6429A1508CD916F3526AD48A3E9AE437A74D553992A4ADC305AB09986B7DFE9B4DB9A544F30261C901E3D2F94A26EC2353A580618CAD712E8DF3D59C382E53E53E0A43D606FE05CA41B66B8D37D9B02990759C2622B3D5B183C4795B97E20564A249B6094B272A66E9F7DF6D88DC638471B8F5DA8D8F798B06C163F40798BC0273AD7272C81495EA69CE842486DE669ACD7EC324F286088542E3A05C803F06CCE15E1A5C4676C7984F336EC651E5F57AA0EB683DC1B106AF720139528DDC28632FF7DE7C23E1E2024C3207370C7CA630FE1C1FDC8B310BA43F70DA9F45AE6663B8CEEB23AC05B7CA80FAFEB52940AE80E01FAB2B5A0551B300EDE6103482C74AFBC91D4C222D40AF17C834D81C85A37D9EA18829D0813CD1C21332C533F7608F98B5669AE8B1469CF4690B199678C7A62DF8BDF733E6A302F4ECA0B9FA7B276391A69316001087ABFE55412363B5887D7BFC9A2294D7646C72052C470BC301E37453F34FEFDCD830AF637C7DED76138AD8D673E72E0E46CAE999B5D4A23690C238F08437576C4EC3805399B954F12662295117BF8429715A434ED5B9D4F63108E4E05DCEB03BE7ABF895646937DA93576138827D71C67A9D44F1A857CC2F1534D563773FB2A7F78A856AFF072700D1C2E822F3F0AE7AE".decode("hex")
#KSA Phase
for k in range(0, len(data)-0x102):
	# k=0x22800
	input = data[k:k+0x102]
	S = range(256)
	j = 0
	out = []
	for i in range(256):
	    j = (j + S[i] + ord( key[i % len(key)] )) % 256
	    S[i] , S[j] = S[j] , S[i]
	#PRGA Phase
	i = j = 0
	for char in input:
	    i = ( i + 1 ) % 256
	    j = ( j + S[i] ) % 256
	    S[i] , S[j] = S[j] , S[i]
	    out.append(chr(ord(char) ^ S[(S[i] + S[j]) % 256]))
	if ''.join(out)[0:4] == "DAVE": break
decrypted_text = ''.join(out)
print decrypted_text.encode("hex")
xor_key = data[0x21000:0x21000+len(key)]

l = [ord(a) ^ ord(b) for a,b in zip(key,xor_key)]
config = ''.join(chr(i) for i in l)
url=""
i=0
while 1:
	url += config[0x97+i]
	i+=1
	if config[0x97+i] =="\x00":
		break
print "config url = ", url
print "RC4 communication key = ", config[0x1a4:0x1a4+512].encode("hex")

